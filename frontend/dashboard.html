<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A.R.E.S. ‚Äî –¶–µ–Ω—Ç—Ä –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–§–ò–ù–ê–õ–¨–ù–´–ô)</title>
    <link rel="stylesheet" href="dashboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* –°—Ç–∏–ª—å –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∏–º–µ—Ç—å –±–æ–ª—å—à–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .tab-content {
            overflow-y: auto; /* –ì–ª–∞–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ */
            flex-grow: 1;
            min-height: 0;
        }
    </style>
</head>
<body>

    <div class="support-container">
        
        <header class="top-bar">
            <div class="logo">A.R.E.S. <span class="subtitle">Dashboard</span></div>
            <nav class="main-tabs">
                <a href="#" class="tab-link active" data-tab="support"><i class="fas fa-headset"></i> <span data-key="tab_support">–¶–µ–Ω—Ç—Ä –ü–æ–¥–¥–µ—Ä–∂–∫–∏</span></a>
                <a href="#" class="tab-link" data-tab="profile"><i class="fas fa-user-circle"></i> <span data-key="tab_profile">–õ–∏—á–Ω—ã–π –ö–∞–±–∏–Ω–µ—Ç</span></a>
                <div class="language-switcher">
                    <span class="current-lang" data-key="lang_current">RU</span>
                    <div class="lang-dropdown">
                        <button class="lang-btn" data-lang="ru" data-key="lang_ru">RU</button>
                        <button class="lang-btn" data-lang="kz" data-key="lang_kz">KZ</button>
                        <button class="lang-btn" data-lang="en" data-key="lang_en">EN</button>
                    </div>
                </div>
                <a href="#" class="logout-btn"><i class="fas fa-sign-out-alt"></i> <span data-key="btn_logout">–í—ã—Ö–æ–¥</span></a>
            </nav>
        </header>

        <div class="main-content">
            
            <div id="support" class="tab-content active" style="display: flex; flex-grow: 1;">
                
                <aside class="ticket-sidebar">
                    <h3><i class="fas fa-clipboard-list"></i> <span data-key="tickets_history">–ò—Å—Ç–æ—Ä–∏—è –¢–∏–∫–µ—Ç–æ–≤</span></h3>
                    <div class="ticket-list" id="ticket-list">
                        <div class="ticket-item ticket-list-item active" data-ticket-id="1051" data-title="ticket_1051" data-status="open">
                            <div class="ticket-title" data-key="ticket_1051">–ù–µ –º–æ–≥—É –∑–∞–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç</div>
                            <div class="ticket-meta">
                                <span class="ticket-status status-open" data-key="status_open">–û—Ç–∫—Ä—ã—Ç</span>
                                <span class="ticket-id">#1051</span>
                            </div>
                        </div>
                        <div class="ticket-item ticket-list-item" data-ticket-id="1050" data-title="ticket_1050" data-status="closed">
                            <div class="ticket-title" data-key="ticket_1050">–í–æ–ø—Ä–æ—Å –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º</div>
                            <div class="ticket-meta">
                                <span class="ticket-status status-closed" data-key="status_closed">–†–µ—à–µ–Ω</span>
                                <span class="ticket-id">#1050</span>
                            </div>
                        </div>
                        <div class="ticket-item ticket-list-item" data-ticket-id="1049" data-title="ticket_1049" data-status="awaiting">
                            <div class="ticket-title" data-key="ticket_1049">–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ</div>
                            <div class="ticket-meta">
                                <span class="ticket-status status-awaiting" data-key="status_awaiting">–ñ–¥—ë–º –≤–∞—Å</span>
                                <span class="ticket-id">#1049</span>
                            </div>
                        </div>
                        <div class="ticket-item ticket-list-item" data-ticket-id="1048" data-title="ticket_1048" data-status="closed">
                            <div class="ticket-title" data-key="ticket_1048">–ü—Ä–æ–±–ª–µ–º–∞ —Å API</div>
                            <div class="ticket-meta">
                                <span class="ticket-status status-closed" data-key="status_closed">–†–µ—à–µ–Ω</span>
                                <span class="ticket-id">#1048</span>
                            </div>
                        </div>
                    </div>
                </aside>

                <main class="chat-area">
                    <div class="current-ticket-info">
                        <h2 id="current-ticket-title">–¢–∏–∫–µ—Ç #1051: –ù–µ –º–æ–≥—É –∑–∞–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç</h2>
                        <div class="ticket-status-bar">
                            <span class="status-label" data-key="status_label">–°—Ç–∞—Ç—É—Å:</span>
                            <span class="status-value status-open" id="current-ticket-status-display" data-key="status_open">–û—Ç–∫—Ä—ã—Ç</span>
                            <button class="close-ticket-btn" id="close-ticket-btn"><i class="fas fa-times-circle"></i> <span data-key="btn_close_ticket">–ó–∞–∫—Ä—ã—Ç—å –¢–∏–∫–µ—Ç</span></button>
                        </div>
                    </div>
                    <div class="chat-messages" id="chat-messages-container">
                        <div class="message ai-message">
                            <div class="message-sender"><i class="fas fa-robot"></i> <span data-key="ai_agent">A.R.E.S. –ê–≥–µ–Ω—Ç</span></div>
                            <div class="message-bubble welcome-bubble" data-key="welcome_message">
                                –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º —Å —Ç–∏–∫–µ—Ç–æ–º #1051.
                            </div>
                            <div class="message-time">06.12.2025 02:20</div>
                        </div>
                        <div class="message user-message">
                            <div class="message-sender"><i class="fas fa-user-edit"></i> <span data-key="you">–í—ã</span></div>
                            <div class="message-bubble">
                                –î–∞, –Ω–µ –º–æ–≥—É –≤–æ–π—Ç–∏.
                            </div>
                            <div class="message-time">06.12.2025 02:22</div>
                        </div>
                    </div>
                    <div class="chat-input">
                        <div class="quick-actions" id="quick-actions"></div>
                        <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." id="chat-text" data-placeholder="input_placeholder">
                        <div class="send-buttons">
                            <button type="button" class="send-btn" id="send-message-btn"><i class="fas fa-paper-plane"></i> <span data-key="btn_send">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</span></button>
                            <button type="button" class="email-btn" id="send-email-btn"><i class="fas fa-envelope"></i> <span data-key="btn_send_email">–ù–∞ Email</span></button>
                        </div>
                    </div>
                </main>
            </div>
            
            <div id="profile" class="tab-content" style="display: none;">
                 <div class="profile-container">
                    <h2 class="profile-header"><i class="fas fa-user-cog"></i> <span data-key="profile_settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ê–∫–∫–∞—É–Ω—Ç–∞</span></h2>
                    <div class="profile-card">
                        <div class="avatar-section">
                            <i class="fas fa-user-circle avatar-icon"></i>
                            <h3 class="user-name-neon">AcmeClient_77</h3>
                            <p class="status-open user-status"><span data-key="status_label">–°—Ç–∞—Ç—É—Å</span>: <span data-key="status_active">–ê–∫—Ç–∏–≤–Ω—ã–π</span></p>
                        </div>
                        <div class="info-section">
                            <h4 data-key="profile_main_info">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                            <div class="info-item"><label data-key="profile_email_label">Email:</label><span id="profile-email">client@acme.com</span></div>
                            <div class="info-item"><label data-key="profile_date_label">–î–∞—Ç–∞ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</label><span id="profile-date">15.08.2024</span></div>
                            <div class="info-item"><label data-key="profile_plan_label">–¢–∞—Ä–∏—Ñ–Ω—ã–π –ü–ª–∞–Ω:</label><span class="plan-pro" data-key="profile_plan_pro">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π (PRO)</span></div>
                            
                            <h4 class="usage-header"><i class="fas fa-chart-bar"></i> <span data-key="profile_usage_title">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞</span></h4>
                            
                            <div class="usage-item">
                                <label data-key="profile_ai_tokens">–¢–æ–∫–µ–Ω—ã –ò–ò (90%):</label>
                                <div class="progress-bar-container"><div class="progress-bar red-fill" style="width: 90%;"></div></div>
                                <span class="usage-value usage-critical">9,000 <span data-key="profile_of">–∏–∑</span> 10,000</span>
                            </div>
                            <div class="usage-item">
                                <label data-key="profile_api_requests">–ó–∞–ø—Ä–æ—Å—ã API (45%):</label>
                                <div class="progress-bar-container"><div class="progress-bar green-fill" style="width: 45%;"></div></div>
                                <span class="usage-value">450 <span data-key="profile_of">–∏–∑</span> 1,000</span>
                            </div>
                        </div>
                    </div>
                    <div class="profile-actions">
                        <button class="action-btn action-red"><i class="fas fa-key"></i> <span data-key="profile_change_password">–°–º–µ–Ω–∏—Ç—å –ü–∞—Ä–æ–ª—å</span></button>
                        <button class="action-btn action-border"><i class="fas fa-file-invoice"></i> <span data-key="profile_payment_history">–ò—Å—Ç–æ—Ä–∏—è –ü–ª–∞—Ç–µ–∂–µ–π</span></button>
                        </div>
                </div>
            </div>

            </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <div id="notifications-container"></div>

    <script>
        // –ü–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const translations = {
            ru: {
                // –û–±—â–∏–µ
                lang_current: 'RU',
                lang_ru: 'RU',
                lang_kz: 'KZ', 
                lang_en: 'EN',
                
                // –í–∫–ª–∞–¥–∫–∏
                tab_support: '–¶–µ–Ω—Ç—Ä –ü–æ–¥–¥–µ—Ä–∂–∫–∏',
                tab_profile: '–õ–∏—á–Ω—ã–π –ö–∞–±–∏–Ω–µ—Ç',
                btn_logout: '–í—ã—Ö–æ–¥',
                
                // –¢–∏–∫–µ—Ç—ã
                tickets_history: '–ò—Å—Ç–æ—Ä–∏—è –¢–∏–∫–µ—Ç–æ–≤',
                status_label: '–°—Ç–∞—Ç—É—Å:',
                status_open: '–û—Ç–∫—Ä—ã—Ç',
                status_closed: '–†–µ—à–µ–Ω',
                status_awaiting: '–ñ–¥—ë–º –≤–∞—Å',
                status_active: '–ê–∫—Ç–∏–≤–Ω—ã–π',
                btn_close_ticket: '–ó–∞–∫—Ä—ã—Ç—å –¢–∏–∫–µ—Ç',
                btn_open_ticket: '–û—Ç–∫—Ä—ã—Ç—å –¢–∏–∫–µ—Ç',
                
                // –ù–∞–∑–≤–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–æ–≤
                ticket_1051: '–ù–µ –º–æ–≥—É –∑–∞–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç',
                ticket_1050: '–í–æ–ø—Ä–æ—Å –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º',
                ticket_1049: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ',
                ticket_1048: '–ü—Ä–æ–±–ª–µ–º–∞ —Å API',
                
                // –ß–∞—Ç
                ai_agent: 'A.R.E.S. –ê–≥–µ–Ω—Ç',
                you: '–í—ã',
                welcome_message: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º —Å —Ç–∏–∫–µ—Ç–æ–º #1051.',
                input_placeholder: '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...',
                btn_send: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å',
                btn_send_email: '–ù–∞ Email –∫–æ–º–ø–∞–Ω–∏–∏',
                
                // –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã
                quick_solved: '–°–ø–∞—Å–∏–±–æ, –≤–æ–ø—Ä–æ—Å —Ä–µ—à–µ–Ω!',
                quick_waiting: '–Ø –∂–¥—É –æ—Ç–≤–µ—Ç–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞.',
                quick_when_answer: '–ö–æ–≥–¥–∞ –±—É–¥–µ—Ç –æ—Ç–≤–µ—Ç?',
                
                // –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                ticket_active_msg: '–¢–∏–∫–µ—Ç #{id} –∞–∫—Ç–∏–≤–µ–Ω. –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º —Å –ø—Ä–æ–±–ª–µ–º–æ–π.',
                ticket_closed_msg: '–≠—Ç–æ—Ç —Ç–∏–∫–µ—Ç –±—ã–ª —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–µ–Ω –∏ –∑–∞–∫—Ä—ã—Ç.',
                ticket_received_msg: '–Ø –ø–æ–ª—É—á–∏–ª –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –¢–∏–∫–µ—Ç #{id} –ø—Ä–∏–Ω—è—Ç –≤ –æ–±—Ä–∞–±–æ—Ç–∫—É.',
                
                // Placeholder'—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤
                status_open_placeholder: '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...',
                status_closed_placeholder: '–¢–∏–∫–µ—Ç –∑–∞–∫—Ä—ã—Ç. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å, –æ—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–π.',
                status_awaiting_placeholder: '–ú—ã –∂–¥–µ–º –≤–∞—à–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.',
                
                // –ü—Ä–æ—Ñ–∏–ª—å
                profile_settings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ê–∫–∫–∞—É–Ω—Ç–∞',
                profile_main_info: '–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
                profile_email_label: 'Email:',
                profile_date_label: '–î–∞—Ç–∞ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:',
                profile_plan_label: '–¢–∞—Ä–∏—Ñ–Ω—ã–π –ü–ª–∞–Ω:',
                profile_plan_pro: '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π (PRO)',
                profile_usage_title: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞',
                profile_ai_tokens: '–¢–æ–∫–µ–Ω—ã –ò–ò (90%):',
                profile_api_requests: '–ó–∞–ø—Ä–æ—Å—ã API (45%):',
                profile_of: '–∏–∑',
                profile_change_password: '–°–º–µ–Ω–∏—Ç—å –ü–∞—Ä–æ–ª—å',
                profile_payment_history: '–ò—Å—Ç–æ—Ä–∏—è –ü–ª–∞—Ç–µ–∂–µ–π',
                
                // Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                email_sent_success: '‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ email –∫–æ–º–ø–∞–Ω–∏–∏. –û–∂–∏–¥–∞–π—Ç–µ –æ—Ç–≤–µ—Ç –Ω–∞ –ø–æ—á—Ç–µ.',
                email_response_time: '–û–±—ã—á–Ω–æ –æ—Ç–≤–µ—á–∞–µ–º –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤',
                email_error: '‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ email. –°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ.'
            },
            kz: {
                // –û–±—â–∏–µ
                lang_current: 'KZ',
                lang_ru: 'RU',
                lang_kz: 'KZ',
                lang_en: 'EN',
                
                // –í–∫–ª–∞–¥–∫–∏
                tab_support: '“ö–æ–ª–¥–∞—É –æ—Ä—Ç–∞–ª—ã“ì—ã',
                tab_profile: '–ñ–µ–∫–µ –∫–∞–±–∏–Ω–µ—Ç',
                btn_logout: '–®—ã“ì—É',
                
                // –¢–∏–∫–µ—Ç—ã
                tickets_history: '–¢–∏–∫–µ—Ç—Ç–µ—Ä —Ç–∞—Ä–∏—Ö—ã',
                status_label: '–ú”ô—Ä—Ç–µ–±–µ:',
                status_open: '–ê—à—ã“õ',
                status_closed: '–®–µ—à—ñ–ª–¥—ñ',
                status_awaiting: '–°—ñ–∑–¥—ñ –∫“Ø—Ç–µ–º—ñ–∑',
                status_active: '–ë–µ–ª—Å–µ–Ω–¥—ñ',
                btn_close_ticket: '–¢–∏–∫–µ—Ç—Ç—ñ –∂–∞–±—É',
                btn_open_ticket: '–¢–∏–∫–µ—Ç—Ç—ñ –∞—à—É',
                
                // –ù–∞–∑–≤–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–æ–≤
                ticket_1051: '–ê–∫–∫–∞—É–Ω—Ç“õ–∞ –∫—ñ—Ä–µ –∞–ª–º–∞–π–º—ã–Ω',
                ticket_1050: '–¢–∞—Ä–∏—Ñ—Ç–∞—Ä —Ç—É—Ä–∞–ª—ã —Å“±—Ä–∞“õ',
                ticket_1049: '–¢”©–ª–µ–º–¥–µ “õ–∞—Ç–µ',
                ticket_1048: 'API –º”ô—Å–µ–ª–µ—Å—ñ',
                
                // –ß–∞—Ç
                ai_agent: 'A.R.E.S. –ê–≥–µ–Ω—Ç—ñ',
                you: '–°—ñ–∑',
                welcome_message: '“ö–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑! –ú–µ–Ω —Å—ñ–∑–≥–µ #1051 —Ç–∏–∫–µ—Ç—ñ–º–µ–Ω –∫”©–º–µ–∫—Ç–µ—Å—É–≥–µ –¥–∞–π—ã–Ω–º—ã–Ω.',
                input_placeholder: '–•–∞–±–∞—Ä–ª–∞–º–∞“£—ã–∑–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑...',
                btn_send: '–ñ—ñ–±–µ—Ä—É',
                btn_send_email: 'Email-“ì–∞',
                
                // –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã
                quick_solved: '–†–∞—Ö–º–µ—Ç, –º”ô—Å–µ–ª–µ —à–µ—à—ñ–ª–¥—ñ!',
                quick_waiting: '–ú–µ–Ω –º–∞–º–∞–Ω–Ω—ã“£ –∂–∞—É–∞–±—ã–Ω –∫“Ø—Ç–µ–º—ñ–Ω.',
                quick_when_answer: '–ñ–∞—É–∞–ø “õ–∞—à–∞–Ω –±–æ–ª–∞–¥—ã?',
                
                // –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                ticket_active_msg: '–¢–∏–∫–µ—Ç #{id} –±–µ–ª—Å–µ–Ω–¥—ñ. –ú–µ–Ω —Å—ñ–∑–≥–µ –º”ô—Å–µ–ª–µ–º–µ–Ω –∫”©–º–µ–∫—Ç–µ—Å—É–≥–µ –¥–∞–π—ã–Ω–º—ã–Ω.',
                ticket_closed_msg: '–ë“±–ª —Ç–∏–∫–µ—Ç —Å”ô—Ç—Ç—ñ —à–µ—à—ñ–ª–¥—ñ –∂”ô–Ω–µ –∂–∞–±—ã–ª–¥—ã.',
                ticket_received_msg: '–ú–µ–Ω —Å—ñ–∑–¥—ñ“£ —Ö–∞–±–∞—Ä–ª–∞–º–∞“£—ã–∑–¥—ã –∞–ª–¥—ã–º. –¢–∏–∫–µ—Ç #{id} ”©“£–¥–µ—É–≥–µ “õ–∞–±—ã–ª–¥–∞–Ω–¥—ã.',
                
                // Placeholder'—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤
                status_open_placeholder: '–•–∞–±–∞—Ä–ª–∞–º–∞“£—ã–∑–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑...',
                status_closed_placeholder: '–¢–∏–∫–µ—Ç –∂–∞–±—ã“õ. –ú”ô—Å–µ–ª–µ “õ–∞–ª—ã–ø “õ–æ–π—Å–∞, –∂–∞“£–∞—Å—ã–Ω –∞—à—ã“£—ã–∑.',
                status_awaiting_placeholder: '–ë—ñ–∑ —Å—ñ–∑–¥—ñ“£ –∂–∞—É–∞–±—ã“£—ã–∑–¥—ã –∂“±–º—ã—Å—Ç—ã –∂–∞–ª“ì–∞—Å—Ç—ã—Ä—É “Ø—à—ñ–Ω –∫“Ø—Ç–µ–º—ñ–∑.',
                
                // –ü—Ä–æ—Ñ–∏–ª—å
                profile_settings: '–ê–∫–∫–∞—É–Ω—Ç –±–∞–ø—Ç–∞—É–ª–∞—Ä—ã',
                profile_main_info: '–ù–µ–≥—ñ–∑–≥—ñ –∞“õ–ø–∞—Ä–∞—Ç',
                profile_email_label: 'Email:',
                profile_date_label: '–¢—ñ—Ä–∫–µ–ª—É –∫“Ø–Ω—ñ:',
                profile_plan_label: '–¢–∞—Ä–∏—Ñ –∂–æ—Å–ø–∞—Ä—ã:',
                profile_plan_pro: '–ñ–µ—Ç—ñ–ª–¥—ñ—Ä—ñ–ª–≥–µ–Ω (PRO)',
                profile_usage_title: '–¢–∞—Ä–∏—Ñ –ø–∞–π–¥–∞–ª–∞–Ω—É—ã',
                profile_ai_tokens: '–ò–ò —Ç–æ–∫–µ–Ω–¥–µ—Ä—ñ (90%):',
                profile_api_requests: 'API —Å“±—Ä–∞—Élarƒ± (45%):',
                profile_of: '–¥–∞–Ω',
                profile_change_password: '“ö“±–ø–∏—è —Å”©–∑–¥—ñ ”©–∑–≥–µ—Ä—Ç—É',
                profile_payment_history: '–¢”©–ª–µ–º —Ç–∞—Ä–∏—Ö—ã',
                
                // Email —Ö–∞–±–∞—Ä–ª–∞–Ω–¥—ã—Ä—É–ª–∞—Ä
                email_sent_success: '‚úÖ –•–∞–±–∞—Ä–ª–∞–º–∞ –∫–æ–º–ø–∞–Ω–∏—è–Ω—ã“£ email-—ñ–Ω–µ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ. –ü–æ—á—Ç–∞–¥–∞ –∂–∞—É–∞–ø—Ç—ã –∫“Ø—Ç—ñ“£—ñ–∑.',
                email_response_time: '”ò–¥–µ—Ç—Ç–µ 24 —Å–∞“ì–∞—Ç —ñ—à—ñ–Ω–¥–µ –∂–∞—É–∞–ø –±–µ—Ä–µ–º—ñ–∑',
                email_error: '‚ùå Email –∂—ñ–±–µ—Ä—É “õ–∞—Ç–µ—Å—ñ. –•–∞–±–∞—Ä–ª–∞–º–∞ –∂–µ—Ä–≥—ñ–ª—ñ–∫—Ç—ñ —Ç“Ø—Ä–¥–µ —Å–∞“õ—Ç–∞–ª–¥—ã.'
            },
            en: {
                // –û–±—â–∏–µ
                lang_current: 'EN',
                lang_ru: 'RU',
                lang_kz: 'KZ',
                lang_en: 'EN',
                
                // –í–∫–ª–∞–¥–∫–∏
                tab_support: 'Support Center',
                tab_profile: 'Profile',
                btn_logout: 'Logout',
                
                // –¢–∏–∫–µ—Ç—ã
                tickets_history: 'Tickets History',
                status_label: 'Status:',
                status_open: 'Open',
                status_closed: 'Resolved',
                status_awaiting: 'Awaiting',
                status_active: 'Active',
                btn_close_ticket: 'Close Ticket',
                btn_open_ticket: 'Open Ticket',
                
                // –ù–∞–∑–≤–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–æ–≤
                ticket_1051: 'Cannot log into account',
                ticket_1050: 'Question about pricing',
                ticket_1049: 'Payment error',
                ticket_1048: 'API issue',
                
                // –ß–∞—Ç
                ai_agent: 'A.R.E.S. Agent',
                you: 'You',
                welcome_message: 'Welcome! I am ready to help you with ticket #1051.',
                input_placeholder: 'Enter your message...',
                btn_send: 'Send',
                btn_send_email: 'To Email',
                
                // –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã
                quick_solved: 'Thank you, issue resolved!',
                quick_waiting: 'I am waiting for a specialist response.',
                quick_when_answer: 'When will there be an answer?',
                
                // –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                ticket_active_msg: 'Ticket #{id} is active. I am ready to help you with the problem.',
                ticket_closed_msg: 'This ticket has been successfully resolved and closed.',
                ticket_received_msg: 'I received your message. Ticket #{id} has been accepted for processing.',
                
                // Placeholder'—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤
                status_open_placeholder: 'Enter your message...',
                status_closed_placeholder: 'Ticket closed. If the problem persists, please open a new one.',
                status_awaiting_placeholder: 'We are waiting for your response to continue.',
                
                // –ü—Ä–æ—Ñ–∏–ª—å
                profile_settings: 'Account Settings',
                profile_main_info: 'Main Information',
                profile_email_label: 'Email:',
                profile_date_label: 'Registration Date:',
                profile_plan_label: 'Plan:',
                profile_plan_pro: 'Advanced (PRO)',
                profile_usage_title: 'Plan Usage',
                profile_ai_tokens: 'AI Tokens (90%):',
                profile_api_requests: 'API Requests (45%):',
                profile_of: 'of',
                profile_change_password: 'Change Password',
                profile_payment_history: 'Payment History',
                
                // Email notifications
                email_sent_success: '‚úÖ Message sent to company email. Please wait for reply in your mailbox.',
                email_response_time: 'We usually respond within 24 hours',
                email_error: '‚ùå Email sending error. Message saved locally.'
            }
        };

        let currentLang = 'ru';
        let activeTicketId = '1051';

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        function updateContent(lang) {
            const langData = translations[lang] || translations['ru'];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å data-key
            document.querySelectorAll('[data-key]').forEach(element => {
                const key = element.getAttribute('data-key');
                if (langData[key]) {
                    element.textContent = langData[key];
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–π —è–∑—ã–∫ –≤ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ
            const currentLangElement = document.querySelector('.current-lang');
            if (currentLangElement) {
                currentLangElement.textContent = langData.lang_current || lang.toUpperCase();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º placeholder –¥–ª—è –ø–æ–ª—è –≤–≤–æ–¥–∞
            const inputElement = document.querySelector('[data-placeholder="input_placeholder"]');
            if (inputElement && langData.input_placeholder) {
                inputElement.placeholder = langData.input_placeholder;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤ –≤ current-ticket-title
            const titleElement = document.getElementById('current-ticket-title');
            if (titleElement && activeTicketId) {
                const ticketKey = 'ticket_' + activeTicketId;
                if (langData[ticketKey]) {
                    titleElement.textContent = `–¢–∏–∫–µ—Ç #${activeTicketId}: ${langData[ticketKey]}`;
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã
            updateQuickReplies(langData);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —è–∑—ã–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞
            document.documentElement.lang = lang;
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±—ã—Å—Ç—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
        function updateQuickReplies(langData) {
            const quickReplies = [
                { text: langData.quick_solved, status: "closed" },
                { text: langData.quick_waiting, status: "awaiting" },
                { text: langData.quick_when_answer, status: "open" }
            ];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º quick actions –µ—Å–ª–∏ –æ–Ω–∏ –≤–∏–¥–Ω—ã
            const quickActionsContainer = document.getElementById('quick-actions');
            if (quickActionsContainer && quickActionsContainer.children.length > 0) {
                quickActionsContainer.innerHTML = '';
                quickReplies.forEach(reply => {
                    const btn = document.createElement('button');
                    btn.className = 'quick-reply-btn';
                    btn.textContent = reply.text;
                    btn.addEventListener('click', () => {
                        chatInput.value = reply.text;
                        chatInput.focus();
                    });
                    quickActionsContainer.appendChild(btn);
                });
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
            window.currentQuickReplies = quickReplies;
            window.currentTranslations = langData;
        }

        // --- –§–£–ù–ö–¶–ò–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –í–ö–õ–ê–î–û–ö ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            document.querySelectorAll('.tab-link').forEach(link => {
                link.classList.remove('active');
            });

            const targetContent = document.getElementById(tabId);
            
            // –õ–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è: flex –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏, block –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ.
            if (tabId === 'support') {
                targetContent.style.display = 'flex';
            } else {
                // –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ (profile) –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–∞–∫ block.
                targetContent.style.display = 'block'; 
            }
            
            const tabLink = document.querySelector(`.tab-link[data-tab="${tabId}"]`);
            if (tabLink) {
                tabLink.classList.add('active');
            }
            
            // –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É, –≤—ã–∑—ã–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É –≤–Ω–∏–∑
            if (tabId === 'support') {
                const chatContainer = document.getElementById('chat-messages-container');
                // –ú–∞–ª–µ–Ω—å–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
                setTimeout(() => {
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }, 50);
            }
        }

        // --- –õ–û–ì–ò–ö–ê –¢–ê–ë–û–í –ò –¢–ò–ö–ï–¢–û–í (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∫—Ä–æ–º–µ –≤—ã–∑–æ–≤–∞ switchTab) ---
        document.addEventListener('DOMContentLoaded', () => {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–∑—ã–∫–∞
            updateContent(currentLang);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞
            document.querySelectorAll('.lang-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const newLang = this.getAttribute('data-lang');
                    if (newLang !== currentLang) {
                        currentLang = newLang;
                        updateContent(currentLang);
                    }
                });
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.tab-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabId = e.currentTarget.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –í—ã—Ö–æ–¥
            document.querySelector('.logout-btn').addEventListener('click', (e) => {
                e.preventDefault();
                // –û—á–∏—â–∞–µ–º localStorage
                localStorage.removeItem('user');
                localStorage.removeItem('user_type');
                localStorage.removeItem('access_token');
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                window.location.href = 'http://localhost:3000/';
            });

            // --- –õ–û–ì–ò–ö–ê –¶–ï–ù–¢–†–ê –ü–û–î–î–ï–†–ñ–ö–ò ---
            const ticketItems = document.querySelectorAll('.ticket-list-item');
            const titleElement = document.getElementById('current-ticket-title');
            const statusDisplay = document.getElementById('current-ticket-status-display');
            const chatContainer = document.getElementById('chat-messages-container');
            const chatInput = document.getElementById('chat-text');
            const sendButton = document.getElementById('send-message-btn');
            const closeButton = document.getElementById('close-ticket-btn');
            const quickActionsContainer = document.getElementById('quick-actions');

            // quickReplies —Ç–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ updateQuickReplies()
            
            function updateStatusDisplay(statusKey, element) {
                const langData = window.currentTranslations || translations['ru'];
                let statusText = '';
                let statusClass = '';
                let statusIcon = '';

                switch (statusKey) {
                    case 'open':
                        statusText = langData.status_open || '–û—Ç–∫—Ä—ã—Ç';
                        statusClass = 'status-open';
                        statusIcon = '<i class="fas fa-circle-dot"></i> ';
                        chatInput.placeholder = langData.status_open_placeholder || "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...";
                        break;
                    case 'closed':
                        statusText = langData.status_closed || '–†–µ—à–µ–Ω';
                        statusClass = 'status-closed';
                        statusIcon = '<i class="fas fa-check-circle"></i> ';
                        chatInput.placeholder = langData.status_closed_placeholder || "–¢–∏–∫–µ—Ç –∑–∞–∫—Ä—ã—Ç. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å, –æ—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–π.";
                        break;
                    case 'awaiting':
                        statusText = langData.status_awaiting || '–ñ–¥—ë–º –≤–∞—Å';
                        statusClass = 'status-awaiting';
                        statusIcon = '<i class="fas fa-clock"></i> ';
                        chatInput.placeholder = langData.status_awaiting_placeholder || "–ú—ã –∂–¥–µ–º –≤–∞—à–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.";
                        break;
                    default:
                        statusText = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                        statusClass = '';
                }
                
                element.className = 'status-value ' + statusClass;
                element.innerHTML = statusIcon + statusText;
                
                if (statusKey === 'closed') {
                    closeButton.innerHTML = '<i class="fas fa-folder-open"></i> ' + (langData.btn_open_ticket || '–û—Ç–∫—Ä—ã—Ç—å –¢–∏–∫–µ—Ç');
                    closeButton.classList.add('status-closed');
                    closeButton.classList.remove('status-open');
                    sendButton.disabled = true;
                } else {
                    closeButton.innerHTML = '<i class="fas fa-times-circle"></i> ' + (langData.btn_close_ticket || '–ó–∞–∫—Ä—ã—Ç—å –¢–∏–∫–µ—Ç');
                    closeButton.classList.add('status-open');
                    closeButton.classList.remove('status-closed');
                    sendButton.disabled = false;
                }
            }

            function generateMockChat(id, status) {
                const langData = window.currentTranslations || translations['ru'];
                const now = new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });

                let chatContent = `
                    <div class="message ai-message">
                        <div class="message-sender"><i class="fas fa-robot"></i> ${langData.ai_agent || 'A.R.E.S. –ê–≥–µ–Ω—Ç'}</div>
                        <div class="message-bubble welcome-bubble">
                            ${(langData.ticket_active_msg || '–¢–∏–∫–µ—Ç #{id} –∞–∫—Ç–∏–≤–µ–Ω. –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º —Å –ø—Ä–æ–±–ª–µ–º–æ–π.').replace('{id}', id)}
                        </div>
                        <div class="message-time">${now}</div>
                    </div>`;

                if (status === 'closed') {
                    chatContent += `
                        <div class="message ai-message">
                            <div class="message-sender"><i class="fas fa-robot"></i> ${langData.ai_agent || 'A.R.E.S. –ê–≥–µ–Ω—Ç'}</div>
                            <div class="message-bubble">
                                ${langData.ticket_closed_msg || '–≠—Ç–æ—Ç —Ç–∏–∫–µ—Ç –±—ã–ª —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–µ–Ω –∏ –∑–∞–∫—Ä—ã—Ç.'}
                            </div>
                            <div class="message-time">${now}</div>
                        </div>`;
                }
                return chatContent;
            }
            
            function renderQuickActions(statusKey) {
                quickActionsContainer.innerHTML = '';
                if (statusKey === 'closed') return;

                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã
                const quickReplies = window.currentQuickReplies || [
                    { text: "–°–ø–∞—Å–∏–±–æ, –≤–æ–ø—Ä–æ—Å —Ä–µ—à–µ–Ω!", status: "closed" },
                    { text: "–Ø –∂–¥—É –æ—Ç–≤–µ—Ç–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞.", status: "awaiting" },
                    { text: "–ö–æ–≥–¥–∞ –±—É–¥–µ—Ç –æ—Ç–≤–µ—Ç?", status: "open" }
                ];
                
                quickReplies.forEach(reply => {
                    const button = document.createElement('button');
                    button.className = 'quick-reply-btn';
                    button.textContent = reply.text;
                    button.addEventListener('click', () => {
                        chatInput.value = reply.text;
                        sendMessage(true);
                    });
                    quickActionsContainer.appendChild(button);
                });
            }

            ticketItems.forEach(item => {
                item.addEventListener('click', () => {
                    ticketItems.forEach(i => i.classList.remove('active'));
                    item.classList.add('active');

                    const id = item.getAttribute('data-ticket-id');
                    const titleKey = item.getAttribute('data-title'); // —Ç–µ–ø–µ—Ä—å —ç—Ç–æ –∫–ª—é—á –ø–µ—Ä–µ–≤–æ–¥–∞
                    const statusKey = item.getAttribute('data-status');
                    
                    const langData = window.currentTranslations || translations['ru'];
                    const titleText = langData[titleKey] || titleKey;
                    
                    activeTicketId = id;
                    titleElement.textContent = `–¢–∏–∫–µ—Ç #${id}: ${titleText}`;
                    
                    updateStatusDisplay(statusKey, statusDisplay);
                    renderQuickActions(statusKey);
                    
                    chatContainer.innerHTML = generateMockChat(id, statusKey);
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                    
                    const statusSpan = item.querySelector('.ticket-status');
                    statusSpan.className = 'ticket-status status-' + statusKey;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å –ø–µ—Ä–µ–≤–æ–¥–æ–º
                    let statusText = '';
                    switch (statusKey) {
                        case 'open': statusText = langData.status_open || '–û—Ç–∫—Ä—ã—Ç'; break;
                        case 'closed': statusText = langData.status_closed || '–†–µ—à–µ–Ω'; break;
                        case 'awaiting': statusText = langData.status_awaiting || '–ñ–¥—ë–º –≤–∞—Å'; break;
                    }
                    statusSpan.textContent = statusText;
                });
            });
            
            sendButton.addEventListener('click', (event) => {
                event.preventDefault();
                sendMessage(false);
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ email
            const emailButton = document.getElementById('send-email-btn');
            emailButton.addEventListener('click', (event) => {
                event.preventDefault();
                event.stopPropagation();
                console.log('üî• –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ email, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
                sendToEmail(event);
                return false;
            });
            
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !sendButton.disabled) {
                    sendMessage(false);
                }
            });

            function sendMessage(isQuickReply) {
                const text = chatInput.value.trim();
                if (text === '' || sendButton.disabled) return;

                const langData = window.currentTranslations || translations['ru'];
                const now = new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
                
                const userMessageHTML = `
                    <div class="message user-message">
                        <div class="message-sender"><i class="fas fa-user-edit"></i> ${langData.you || '–í—ã'}</div>
                        <div class="message-bubble">${text}</div>
                        <div class="message-time">${now}</div>
                    </div>
                `;
                chatContainer.insertAdjacentHTML('beforeend', userMessageHTML);
                chatInput.value = '';
                
                if (!isQuickReply) {
                    setTimeout(() => {
                        const aiResponseHTML = `
                            <div class="message ai-message">
                                <div class="message-sender"><i class="fas fa-robot"></i> ${langData.ai_agent || 'A.R.E.S. –ê–≥–µ–Ω—Ç'}</div>
                                <div class="message-bubble">
                                    ${(langData.ticket_received_msg || '–Ø –ø–æ–ª—É—á–∏–ª –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –¢–∏–∫–µ—Ç #{id} –ø—Ä–∏–Ω—è—Ç –≤ –æ–±—Ä–∞–±–æ—Ç–∫—É.').replace('{id}', activeTicketId)}
                                </div>
                                <div class="message-time">${new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}</div>
                            </div>
                        `;
                        chatContainer.insertAdjacentHTML('beforeend', aiResponseHTML);
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                    }, 1000);
                }
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }

            async function sendToEmail(event) {
                if (event) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                console.log('üìß –ó–∞–ø—É—Å–∫ —Ñ—É–Ω–∫—Ü–∏–∏ sendToEmail');
                
                const text = chatInput.value.trim();
                if (text === '') {
                    showNotification('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏', 'error');
                    return false;
                }

                const langData = window.currentTranslations || translations['ru'];
                const emailButton = document.getElementById('send-email-btn');
                
                // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –≤–æ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏
                emailButton.disabled = true;
                emailButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –û—Ç–ø—Ä–∞–≤–∫–∞...';
                
                try {
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —á–∞—Ç
                    const now = new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
                    const userMessageHTML = `
                        <div class="message user-message">
                            <div class="message-sender"><i class="fas fa-user-edit"></i> ${langData.you || '–í—ã'}</div>
                            <div class="message-bubble">${text}</div>
                            <div class="message-time">${now}</div>
                        </div>
                    `;
                    chatContainer.insertAdjacentHTML('beforeend', userMessageHTML);
                    chatInput.value = '';
                    
                    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const userData = localStorage.getItem('user');
                    let userEmail = 'unknown@example.com';
                    let userName = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                    
                    if (userData) {
                        const user = JSON.parse(userData);
                        userEmail = user.email || userEmail;
                        userName = user.username || user.company_name || userName;
                    }
                    
                    console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ backend...'); // –û—Ç–ª–∞–¥–∫–∞
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ backend
                    const response = await fetch('http://localhost:8000/api/email/send', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            to_email: 'support@company.com', // Email –∫–æ–º–ø–∞–Ω–∏–∏
                            subject: `–ù–æ–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –æ—Ç ${userName} - –¢–∏–∫–µ—Ç #${activeTicketId}`,
                            body: `–û–±—Ä–∞—â–µ–Ω–∏–µ –æ—Ç: ${userName} (${userEmail})
–¢–∏–∫–µ—Ç: #${activeTicketId}
–í—Ä–µ–º—è: ${new Date().toLocaleString('ru-RU')}

–°–æ–æ–±—â–µ–Ω–∏–µ:
${text}

---
–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ SmartFlow AI HelpDesk`,
                            ticket_id: activeTicketId
                        })
                    });

                    const result = await response.json();
                    console.log('–û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', result); // –û—Ç–ª–∞–¥–∫–∞
                    
                    if (response.ok && result.status === 'success') {
                        console.log('üéâ Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ, –ø–æ–∫–∞–∑—ã–≤–∞—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ');
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ
                        const successMsg = langData.email_sent_success || '‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ email –∫–æ–º–ø–∞–Ω–∏–∏';
                        const timeMsg = langData.email_response_time || '–û–±—ã—á–Ω–æ –æ—Ç–≤–µ—á–∞–µ–º –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤';
                        console.log('üìù –¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', successMsg, timeMsg);
                        const notification = showNotification(`${successMsg}<br><small>${timeMsg}</small>`, 'success');
                        console.log('üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ:', notification);
                    } else {
                        throw new Error(result.detail || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ email');
                    }
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ email:', error);
                    console.error('–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:', error.message); // –û—Ç–ª–∞–¥–∫–∞
                    const errorMsg = langData.email_error || '‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ email. –°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ.';
                    showNotification(errorMsg, 'error');
                    
                } finally {
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                    emailButton.disabled = false;
                    emailButton.innerHTML = `<i class="fas fa-envelope"></i> <span data-key="btn_send_email">${langData.btn_send_email || '–ù–∞ Email'}</span>`;
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }
                
                console.log('üìß –§—É–Ω–∫—Ü–∏—è sendToEmail –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                return false;
            }

            function showNotification(message, type = 'info') {
                console.log('üîî –ü–æ–∫–∞–∑—ã–≤–∞—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:', message, type);
                
                // –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                let container = document.getElementById('notifications-container');
                if (!container) {
                    console.log('üì¶ –°–æ–∑–¥–∞—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');
                    container = document.createElement('div');
                    container.id = 'notifications-container';
                    container.style.cssText = `
                        position: fixed !important;
                        top: 20px !important;
                        right: 20px !important;
                        z-index: 99999 !important;
                        max-width: 450px !important;
                        pointer-events: none !important;
                    `;
                    document.body.appendChild(container);
                }
                
                // –°–æ–∑–¥–∞—ë–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.style.cssText = `
                    background: ${type === 'error' ? 'rgba(244, 67, 54, 0.95)' : 'rgba(76, 175, 80, 0.95)'} !important;
                    border: 2px solid ${type === 'error' ? 'rgba(244, 67, 54, 0.8)' : 'rgba(76, 175, 80, 0.8)'} !important;
                    color: white !important;
                    border-radius: 8px !important;
                    margin-bottom: 12px !important;
                    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4) !important;
                    backdrop-filter: blur(15px) !important;
                    transform: translateX(120%) scale(0.8) !important;
                    opacity: 0 !important;
                    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
                    pointer-events: all !important;
                    min-height: 60px !important;
                    position: relative !important;
                    overflow: hidden !important;
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                notification.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 18px 22px; gap: 15px;">
                        <div style="flex-grow: 1; font-weight: 500; line-height: 1.5; font-size: 14px;">
                            ${message}
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" style="
                            background: rgba(255, 255, 255, 0.15) !important;
                            border: none !important;
                            color: white !important;
                            width: 28px !important;
                            height: 28px !important;
                            border-radius: 50% !important;
                            cursor: pointer !important;
                            font-size: 14px !important;
                            font-weight: bold !important;
                        ">‚úï</button>
                    </div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                container.appendChild(notification);
                console.log('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ DOM');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                setTimeout(() => {
                    console.log('üé¨ –ó–∞–ø—É—Å–∫–∞—é –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ—è–≤–ª–µ–Ω–∏—è');
                    notification.style.transform = 'translateX(0) scale(1)';
                    notification.style.opacity = '1';
                }, 100);
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–±–∏—Ä–∞–µ–º —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥
                const hideTimer = setTimeout(() => {
                    console.log('‚è∞ 15 —Å–µ–∫—É–Ω–¥ –ø—Ä–æ—à–ª–æ, —Å–∫—Ä—ã–≤–∞—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ');
                    if (notification && notification.parentNode) {
                        notification.style.transform = 'translateX(120%) scale(0.8)';
                        notification.style.opacity = '0';
                        
                        setTimeout(() => {
                            if (notification && notification.parentNode) {
                                notification.remove();
                                console.log('üóëÔ∏è –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ');
                            }
                        }, 400);
                    }
                }, 15000);
                
                // –ü–∞—É–∑–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
                notification.addEventListener('mouseenter', () => {
                    console.log('üñ±Ô∏è –ú—ã—à—å –Ω–∞–¥ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é —Ç–∞–π–º–µ—Ä');
                    clearTimeout(hideTimer);
                });
                
                console.log('üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ, —Ç–∞–π–º–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ 15 —Å–µ–∫—É–Ω–¥');
                return notification;
            }

            closeButton.addEventListener('click', () => {
                const activeItem = document.querySelector('.ticket-item.active');
                if (!activeItem) return;

                const langData = window.currentTranslations || translations['ru'];
                const currentStatus = activeItem.getAttribute('data-status');
                let newStatus = currentStatus === 'closed' ? 'open' : 'closed';
                
                activeItem.setAttribute('data-status', newStatus);
                
                const statusSpan = activeItem.querySelector('.ticket-status');
                statusSpan.className = 'ticket-status status-' + newStatus;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å –ø–µ—Ä–µ–≤–æ–¥–æ–º
                let statusText = '';
                switch (newStatus) {
                    case 'open': statusText = langData.status_open || '–û—Ç–∫—Ä—ã—Ç'; break;
                    case 'closed': statusText = langData.status_closed || '–†–µ—à–µ–Ω'; break;
                }
                statusSpan.textContent = statusText;

                updateStatusDisplay(newStatus, statusDisplay);
                renderQuickActions(newStatus); 

                chatContainer.innerHTML = generateMockChat(activeTicketId, newStatus);
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            updateStatusDisplay('open', statusDisplay);
            renderQuickActions('open');
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage
            const userData = localStorage.getItem('user');
            const userType = localStorage.getItem('user_type');
            
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    
                    if (userType === 'client') {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
                        document.querySelector('.user-name-neon').textContent = user.username || 'User';
                        document.getElementById('profile-email').textContent = user.email || 'N/A';
                        document.getElementById('profile-date').textContent = new Date(user.created_at).toLocaleDateString('ru-RU');
                    } else if (userType === 'company') {
                        // –î–ª—è –∫–æ–º–ø–∞–Ω–∏–∏
                        document.querySelector('.user-name-neon').textContent = user.company_name || user.username || 'Company';
                        document.getElementById('profile-email').textContent = user.email || 'N/A';
                        document.getElementById('profile-date').textContent = new Date(user.created_at).toLocaleDateString('ru-RU');
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏)
            window.testNotification = function(message = '–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ', type = 'success') {
                console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:', message, type);
                showNotification(message, type);
            };
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
            setTimeout(() => {
                console.log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, —Ç–µ—Å—Ç–∏—Ä—É—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è...');
                // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –Ω–∏–∂–µ –¥–ª—è –∞–≤—Ç–æ—Ç–µ—Å—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
                // testNotification('–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
            }, 2000);
        });
    </script>
</body>
</html>